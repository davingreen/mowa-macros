{"version":3,"sources":["../../src/macros.js"],"names":["config","Firebase","getMacrosConfig","podio","PODIO_CLIENT","appNames","keys","PODIO_APPS","appName","console","log","authorize","app","getApp","id","meta","appFieldLabels","DataPrep","getAppFieldLabels","fields","headerRow","concat","map","sheetValues","items","getAppItems","item","itemToArray","process","env","NODE_ENV","Google","GOOGLE_CLIENT","replaceSheet","SHEET_ID","e","error","ExportPodioData","TriggerMacros"],"mappings":"8HAKA;6EAEO,WAAiC,CACvC,GAAI,CACH,KAAMA,QAAS,KAAMC,UAASC,eAAT,EAArB,CACA,GAAIC,OAAQ,oBAAaH,OAAOI,YAApB,CAAZ,CACA,GAAIC,UAAW,iBAAEC,IAAF,CAAON,OAAOO,UAAd,CAAf,CAEA,IAAK,GAAIC,QAAT,GAAoBH,SAApB,CAA8B,CAC7BI,QAAQC,GAAR,CAAYF,OAAZ,EACA,KAAML,OAAMQ,SAAN,CAAgBX,OAAOO,UAAP,CAAkBC,OAAlB,CAAhB,CAAN,CACA,GAAII,KAAM,KAAMT,OAAMU,MAAN,CAAab,OAAOO,UAAP,CAAkBC,OAAlB,EAA2BM,EAAxC,CAAhB,CACA,GAAIC,MAAO,CACV,SADU,CAEV,eAFU,CAGV,aAHU,CAIV,OAJU,CAKV,aALU,CAMV,YANU,CAOV,YAPU,CAQV,MARU,CASV,UATU,CAAX,CAYA,GAAIC,gBAAiBC,SAASC,iBAAT,CAA2BN,IAAIO,MAA/B,CAArB,CAEA,GAAIC,WAAY,iBAAEC,MAAF,CAASN,IAAT,CAAe,iBAAEO,GAAF,CAAMN,cAAN,CAAsB,OAAtB,CAAf,CAAhB,CAEA,GAAIO,aAAc,CAACH,SAAD,CAAlB,CAEA;AACA,GAAII,OAAQ,KAAMrB,OAAMsB,WAAN,CAAkBzB,OAAOO,UAAP,CAAkBC,OAAlB,EAA2BM,EAA7C,CAAlB,CAEA,IAAK,GAAIY,KAAT,GAAiBF,MAAjB,CAAwB,CACvBD,YAAc,iBAAEF,MAAF,CAASE,WAAT,CAAsB,CACnCN,SAASU,WAAT,CAAqBD,IAArB,CAA2BX,IAA3B,CAAiC,iBAAEO,GAAF,CAAMN,cAAN,CAAsB,aAAtB,CAAjC,CADmC,CAAtB,CAGd,CACD,GAAI,CAAC,CAACY,QAAQC,GAAR,CAAYC,QAAd,EAA0BF,QAAQC,GAAR,CAAYC,QAAZ,GAAyB,OAAvD,CAAgE,CAC/D;AACA,CAFD,IAEO,CACN,KAAMC,QAAOpB,SAAP,CAAiBX,OAAOgC,aAAxB,CAAN,CACA,KAAMD,QAAOE,YAAP,CAAoBjC,OAAOkC,QAA3B,CAAqC1B,OAArC,CAA8Ce,WAA9C,CACN,CACD,CACD,MAAO,KACP,CAAC,MAAOY,CAAP,CAAU,CACX1B,QAAQ2B,KAAR,CAAcD,CAAd,EACA,MAAO,MACP,CACD,C,iBAhDqBE,gB,oHAkDf,WAA+B,CAAE,C,iBAAlBC,c,2CAzDtB,0C,GAAYrC,S,oCACZ,sC,GAAY8B,O,kCACZ,0C,GAAYd,S,oCACZ,oC,2CACA,8B","file":"macros.js","sourcesContent":["import * as Firebase from \"./utils/firebase\"\r\nimport * as Google from \"./utils/google\"\r\nimport * as DataPrep from \"./utils/dataPrep\"\r\nimport PodioAPI from \"./utils/podio\"\r\nimport _ from \"lodash\"\r\n//let fs = require(\"fs-extra\")\r\n\r\nexport async function ExportPodioData() {\r\n\ttry {\r\n\t\tconst config = await Firebase.getMacrosConfig()\r\n\t\tlet podio = new PodioAPI(config.PODIO_CLIENT)\r\n\t\tlet appNames = _.keys(config.PODIO_APPS)\r\n\r\n\t\tfor (let appName of appNames) {\r\n\t\t\tconsole.log(appName)\r\n\t\t\tawait podio.authorize(config.PODIO_APPS[appName])\r\n\t\t\tlet app = await podio.getApp(config.PODIO_APPS[appName].id)\r\n\t\t\tlet meta = [\r\n\t\t\t\t\"item_id\",\r\n\t\t\t\t\"last_event_on\",\r\n\t\t\t\t\"app_item_id\",\r\n\t\t\t\t\"title\",\r\n\t\t\t\t\"created_via\",\r\n\t\t\t\t\"created_by\",\r\n\t\t\t\t\"created_on\",\r\n\t\t\t\t\"link\",\r\n\t\t\t\t\"revision\"\r\n\t\t\t]\r\n\r\n\t\t\tlet appFieldLabels = DataPrep.getAppFieldLabels(app.fields)\r\n\r\n\t\t\tlet headerRow = _.concat(meta, _.map(appFieldLabels, \"label\"))\r\n\r\n\t\t\tlet sheetValues = [headerRow]\r\n\r\n\t\t\t//let items = await fs.readJson(\"../../testItems.json\")\r\n\t\t\tlet items = await podio.getAppItems(config.PODIO_APPS[appName].id)\r\n\r\n\t\t\tfor (let item of items) {\r\n\t\t\t\tsheetValues = _.concat(sheetValues, [\r\n\t\t\t\t\tDataPrep.itemToArray(item, meta, _.map(appFieldLabels, \"external_id\"))\r\n\t\t\t\t])\r\n\t\t\t}\r\n\t\t\tif (!!process.env.NODE_ENV && process.env.NODE_ENV === \"local\") {\r\n\t\t\t\t//fs.writeFile(\"../../results.json\", JSON.stringify(sheetValues), 'utf8', (err) => console.log('done', err)) // Enable if refreshing the data in the local testItems.json\r\n\t\t\t} else {\r\n\t\t\t\tawait Google.authorize(config.GOOGLE_CLIENT)\r\n\t\t\t\tawait Google.replaceSheet(config.SHEET_ID, appName, sheetValues)\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true\r\n\t} catch (e) {\r\n\t\tconsole.error(e)\r\n\t\treturn false\r\n\t}\r\n}\r\n\r\nexport async function TriggerMacros() {}\r\n"]}