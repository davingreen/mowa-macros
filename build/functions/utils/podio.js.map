{"version":3,"sources":["../../../src/utils/podio.js"],"names":["PodioAPI","constructor","clientInfo","apiUrl","tokenUrl","headers","Authorization","authorize","credentials","type","scope","tokens","post","form","grant_type","username","password","client_id","id","client_secret","secret","JSON","parse","access_token","app_id","app_token","token","e","console","error","Error","getApp","response","uri","getAppItems","options","limit","offset","all","body","stringify","items","length","total","concat","auth","Promise","resolve","reject","config","users","then","catch","err","apps","verifyHook","hook_id","code","filterItems","app","log","result","getItem","get","item","fields","getFieldValues","getItemReferences","refs","keyBy","newItem","updateItem","put","comment","msg","value","deleteComment","delete","getRevisedFieldIds","from","to","fieldRevisions","map","field","values","join","item_id","start_date","end_date","city","map_in_sync","country","state","postal_code","lat","lng","street_address","full_address","formatted"],"mappings":"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","file":"podio.js","sourcesContent":["import _ from \"lodash\"\r\n\r\nimport request from \"request-promise\"\r\n//require('request-debug')(request) // Uncomment for full network console outputs.\r\n\r\nexport default class PodioAPI {\r\n\tconstructor(clientInfo) {\r\n\t\t//this.config = config\r\n\t\tthis.apiUrl = \"https://api.podio.com\"\r\n\t\tthis.tokenUrl = \"https://podio.com/oauth/token\"\r\n\t\tthis.headers = {\r\n\t\t\tAuthorization: \"\"\r\n\t\t}\r\n\t\tthis.clientInfo = clientInfo\r\n\t}\r\n\tasync authorize(credentials, type, scope = \"global\") {\r\n\t\ttry {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase \"user\": {\r\n\t\t\t\t\tlet tokens = await request.post(this.tokenUrl, {\r\n\t\t\t\t\t\tform: {\r\n\t\t\t\t\t\t\tgrant_type: \"password\",\r\n\t\t\t\t\t\t\tusername: credentials.username,\r\n\t\t\t\t\t\t\tpassword: credentials.password,\r\n\t\t\t\t\t\t\tclient_id: this.clientInfo.id,\r\n\t\t\t\t\t\t\tclient_secret: this.clientInfo.secret\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.headers[\"Authorization\"] =\r\n\t\t\t\t\t\t\"Bearer \" + JSON.parse(tokens).access_token\r\n\t\t\t\t\treturn this\r\n\t\t\t\t}\r\n\t\t\t\tdefault: {\r\n\t\t\t\t\tlet tokens = await request.post(this.tokenUrl, {\r\n\t\t\t\t\t\tform: {\r\n\t\t\t\t\t\t\tgrant_type: \"app\",\r\n\t\t\t\t\t\t\tapp_id: credentials.id,\r\n\t\t\t\t\t\t\tapp_token: credentials.token,\r\n\t\t\t\t\t\t\tclient_id: this.clientInfo.id,\r\n\t\t\t\t\t\t\tclient_secret: this.clientInfo.secret\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.headers[\"Authorization\"] =\r\n\t\t\t\t\t\t\"Bearer \" + JSON.parse(tokens).access_token\r\n\t\t\t\t\treturn this\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n      console.error(e)\r\n\t\t\tthrow new Error(\"Error authenticating Podio.\")\r\n\t\t}\r\n  }\r\n  async getApp(app_id) {\r\n    try {\r\n      let response = await request({\r\n\t\t\t\theaders: this.headers,\r\n        uri: this.apiUrl + \"/app/\" + app_id,\r\n      })\r\n      return JSON.parse(response)\r\n    }\r\n    catch (e) {\r\n      console.error(e)\r\n      throw new Error('Error getting app.')\r\n    }\r\n  }\r\n\tasync getAppItems(app_id, options = {limit: 500, offset: 0}, all = true) {\r\n\t\ttry {\r\n\t\t\tlet response = await request.post({\r\n\t\t\t\theaders: this.headers,\r\n        uri: this.apiUrl + \"/item/app/\" + app_id + \"/filter\",\r\n        body: JSON.stringify(\r\n          options\r\n        )\r\n      }) \r\n      response = JSON.parse(response)\r\n      let items = response.items\r\n\r\n      if (all && (options.offset + response.items.length) < response.total) {\r\n        options.offset += 500\r\n        items = _.concat(items,await this.getAppItems(app_id, options))\r\n      }\r\n      return items\r\n\t\t} catch (e) {\r\n      console.error(e)\r\n\t\t\tthrow new Error(\"Error getting app items.\")\r\n\t\t}\r\n\t}\r\n\r\n\tauth(type, scope) {\r\n\t\tswitch (type) {\r\n\t\t\tcase \"user\": {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\trequest\r\n\t\t\t\t\t\t.post(\"https://podio.com/oauth/token\", {\r\n\t\t\t\t\t\t\tform: {\r\n\t\t\t\t\t\t\t\tgrant_type: \"password\",\r\n\t\t\t\t\t\t\t\tusername: this.config.users[scope].username,\r\n\t\t\t\t\t\t\t\tpassword: this.config.users[scope].password,\r\n\t\t\t\t\t\t\t\tclient_id: this.config.client_id,\r\n\t\t\t\t\t\t\t\tclient_secret: this.config.client_secret\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.then(token => {\r\n\t\t\t\t\t\t\tthis.headers[\"Authorization\"] =\r\n\t\t\t\t\t\t\t\t\"Bearer \" + JSON.parse(token).access_token\r\n\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\treject(err)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tcase \"app\": {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\trequest\r\n\t\t\t\t\t\t.post(\"https://podio.com/oauth/token\", {\r\n\t\t\t\t\t\t\tform: {\r\n\t\t\t\t\t\t\t\tgrant_type: \"app\",\r\n\t\t\t\t\t\t\t\tapp_id: this.config.apps[scope].id,\r\n\t\t\t\t\t\t\t\tapp_token: this.config.apps[scope].token,\r\n\t\t\t\t\t\t\t\tclient_id: this.config.client_id,\r\n\t\t\t\t\t\t\t\tclient_secret: this.config.client_secret\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.then(token => {\r\n\t\t\t\t\t\t\tthis.headers[\"Authorization\"] =\r\n\t\t\t\t\t\t\t\t\"Bearer \" + JSON.parse(token).access_token\r\n\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\t\treject(err)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tverifyHook(hook_id, code) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.post({\r\n\t\t\t\t\turi: this.apiUrl + \"/hook/\" + hook_id + \"/verify/validate\",\r\n\t\t\t\t\theaders: this.headers,\r\n\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\tcode: code\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t.then(resolve())\r\n\t\t})\r\n\t}\r\n\tfilterItems(app, options) {\r\n\t\tconsole.log(\"Filtering...\")\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.post({\r\n\t\t\t\t\turi:\r\n\t\t\t\t\t\tthis.apiUrl + \"/item/app/\" + this.config.apps[app].id + \"/filter\",\r\n\t\t\t\t\theaders: this.headers\r\n\t\t\t\t})\r\n\t\t\t\t.then(result => {\r\n\t\t\t\t\tlet items = JSON.parse(result).items\r\n\t\t\t\t\tresolve(items)\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\tgetItem(id) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.get({\r\n\t\t\t\t\turi: this.apiUrl + \"/item/\" + id + \"?mark_as_viewed=false\",\r\n\t\t\t\t\theaders: this.headers\r\n\t\t\t\t})\r\n\t\t\t\t.then(item => {\r\n\t\t\t\t\titem = JSON.parse(item)\r\n\t\t\t\t\titem.fields = getFieldValues(item.fields)\r\n\t\t\t\t\tresolve(item)\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\tgetItemReferences(item) {\r\n\t\tlet refs =\r\n\t\t\t!!item.refs && item.refs.length != 0\r\n\t\t\t\t? _.keyBy(item.refs, \"app.name\")\r\n\t\t\t\t: false\r\n\t\treturn refs\r\n\t}\r\n\tnewItem(app, options) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.post({\r\n\t\t\t\t\turi: this.apiUrl + \"/item/app/\" + this.config.apps[app].id,\r\n\t\t\t\t\theaders: this.headers,\r\n\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\tfields: options.fields\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t.then(item => {\r\n\t\t\t\t\tresolve(JSON.parse(item))\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\tupdateItem(id, options) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.put({\r\n\t\t\t\t\turi: this.apiUrl + \"/item/\" + id + \"?hook=false\",\r\n\t\t\t\t\theaders: this.headers,\r\n\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\tfields: options.fields\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t.then(item => {\r\n\t\t\t\t\tif (item == \"\") resolve()\r\n\t\t\t\t\telse resolve(JSON.parse(item))\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\tcomment(id, msg = \"\", options = {}) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.post({\r\n\t\t\t\t\turi: this.apiUrl + \"/comment/\" + \"item\" + \"/\" + id + \"?hook=false\",\r\n\t\t\t\t\theaders: this.headers,\r\n\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\tvalue: msg\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t.then(comment => {\r\n\t\t\t\t\tresolve(JSON.parse(comment))\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\tdeleteComment(id) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.delete({\r\n\t\t\t\t\turi: this.apiUrl + \"/comment/\" + id + \"?hook=false\",\r\n\t\t\t\t\theaders: this.headers\r\n\t\t\t\t})\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\tgetRevisedFieldIds(id, from, to) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\trequest\r\n\t\t\t\t.get({\r\n\t\t\t\t\turi: this.apiUrl + \"/item/\" + id + \"/revision/\" + from + \"/\" + to,\r\n\t\t\t\t\theaders: this.headers\r\n\t\t\t\t})\r\n\t\t\t\t.then(fieldRevisions => {\r\n\t\t\t\t\tresolve(_.map(JSON.parse(fieldRevisions), \"external_id\"))\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\nfunction getFieldValues(fields) {\r\n\tif (!fields || !fields.length) {\r\n\t\treturn fields\r\n\t}\r\n\tvar fields = _.map(fields, function(field) {\r\n\t\tif (!field.values) {\r\n\t\t\treturn field\r\n\t\t}\r\n\t\tswitch (field.type) {\r\n\t\t\tcase \"app\": {\r\n\t\t\t\tif (field.values.length > 1) {\r\n\t\t\t\t\tfield.value = _.join(_.map(field.values, \"value.item_id\"), \",\")\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tfield.value = field.values[0].value.item_id\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"category\": {\r\n\t\t\t\tfield.value = _.join(_.map(field.values, \"value.text\"), \",\")\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"date\": {\r\n\t\t\t\tfield.value = { start_date: \"\", end_date: \"\" }\r\n\t\t\t\tfield.value.start_date = field.values[0].start_date\r\n\t\t\t\tif (!!field.values[0].end_date) {\r\n\t\t\t\t\tfield.value.end_date = field.values[0].end_date\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfield.value.end_date = field.value.start_date\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"location\": {\r\n\t\t\t\tif (field.values.length > 0) {\r\n\t\t\t\t\tfield.value = field.values[0]\r\n\t\t\t\t\tfield.value.city = !!field.value.city ? field.value.city : \"\"\r\n\t\t\t\t\tfield.value.map_in_sync = !!field.value.map_in_sync\r\n\t\t\t\t\t\t? field.value.map_in_sync\r\n\t\t\t\t\t\t: false\r\n\t\t\t\t\tfield.value.country = !!field.value.country ? field.value.country : \"\"\r\n\t\t\t\t\tfield.value.state = !!field.value.state ? field.value.state : \"\"\r\n\t\t\t\t\tfield.value.postal_code = !!field.value.postal_code\r\n\t\t\t\t\t\t? field.value.postal_code\r\n\t\t\t\t\t\t: \"\"\r\n\t\t\t\t\tfield.value.lat = !!field.value.lat ? field.value.lat : \"\"\r\n\t\t\t\t\tfield.value.lng = !!field.value.lng ? field.value.lng : \"\"\r\n\t\t\t\t\tfield.value.street_address = !!field.value.street_address\r\n\t\t\t\t\t\t? field.value.street_address\r\n\t\t\t\t\t\t: \"\"\r\n\t\t\t\t\tfield.value.full_address = !!field.value.formatted\r\n\t\t\t\t\t\t? field.value.formatted\r\n\t\t\t\t\t\t: \"\"\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"email\":\r\n\t\t\tcase \"phone\": {\r\n\t\t\t\tif (field.values.length > 0) {\r\n\t\t\t\t\tfield.value = _.join(_.map(field.values, \"value\"), \",\")\r\n\t\t\t\t\tfield.type = _.join(_.map(field.values, \"type\"), \",\")\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tfield.type = field.values[0].type\r\n\t\t\t\tfield.value = field.values[0].value\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tcase \"calculation\":\r\n\t\t\tcase \"number\":\r\n\t\t\tcase \"text\": {\r\n\t\t\t\tfield.value = field.values[0].value\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn field\r\n\t})\r\n\treturn _.keyBy(fields, \"external_id\")\r\n}\r\n"]}