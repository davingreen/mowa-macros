"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TriggerMacros=exports.ExportPodioData=undefined;//let fs = require("fs-extra")
let ExportPodioData=exports.ExportPodioData=(()=>{var _ref=_asyncToGenerator(function*(){try{const config=yield Firebase.getMacrosConfig();let podio=new _podio2.default(config.PODIO_CLIENT);let appNames=_lodash2.default.keys(config.PODIO_APPS);for(let appName of appNames){console.log(appName);yield podio.authorize(config.PODIO_APPS[appName]);let app=yield podio.getApp(config.PODIO_APPS[appName].id);let meta=["item_id","last_event_on","app_item_id","title","created_via","created_by","created_on","link","revision"];let appFieldLabels=DataPrep.getAppFieldLabels(app.fields);let headerRow=_lodash2.default.concat(meta,_lodash2.default.map(appFieldLabels,"label"));let sheetValues=[headerRow];//let items = await fs.readJson("../../testItems.json")
let items=yield podio.getAppItems(config.PODIO_APPS[appName].id);for(let item of items){sheetValues=_lodash2.default.concat(sheetValues,[DataPrep.itemToArray(item,meta,_lodash2.default.map(appFieldLabels,"external_id"))])}if(!!process.env.NODE_ENV&&process.env.NODE_ENV==="local"){//fs.writeFile("../../results.json", JSON.stringify(sheetValues), 'utf8', (err) => console.log('done', err)) // Enable if refreshing the data in the local testItems.json
}else{yield Google.authorize(config.GOOGLE_CLIENT);yield Google.replaceSheet(config.SHEET_ID,appName,sheetValues)}}return true}catch(e){console.error(e);return false}});return function ExportPodioData(){return _ref.apply(this,arguments)}})();let TriggerMacros=exports.TriggerMacros=(()=>{var _ref2=_asyncToGenerator(function*(){});return function TriggerMacros(){return _ref2.apply(this,arguments)}})();var _firebase=require("./utils/firebase");var Firebase=_interopRequireWildcard(_firebase);var _google=require("./utils/google");var Google=_interopRequireWildcard(_google);var _dataPrep=require("./utils/dataPrep");var DataPrep=_interopRequireWildcard(_dataPrep);var _podio=require("./utils/podio");var _podio2=_interopRequireDefault(_podio);var _lodash=require("lodash");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}
//# sourceMappingURL=macros.js.map